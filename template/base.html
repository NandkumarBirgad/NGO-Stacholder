<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>NGO Manager</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <aside class="sidebar">
        <div>
            <div class="brand">
                <div class="logo">N</div>
                <div>
                    <h2>NGO Manager</h2>
                    <p style="font-size:12px; opacity:0.9;">VoloTrack</p>
                </div>
            </div>

            <nav>
                <a href="/" class="active"><span class="nav-icon">ğŸ“Š</span> Dashboard</a>
                <a href="/stakeholders"><span class="nav-icon">ğŸ‘¥</span> Stakeholders</a>
                <a href="/projects"><span class="nav-icon">ğŸ“‚</span> Projects</a>
                <a href="/activities"><span class="nav-icon">ğŸ—“ï¸</span> Activities</a>
                <a href="/donations"><span class="nav-icon">ğŸ’°</span> Donations</a>
                <a href="/analytics"><span class="nav-icon">ğŸ“ˆ</span> Analytics</a>
            </nav>
        </div>

        <div class="user">
            <div class="avatar">NA</div>
            <div>
                <div style="font-weight:700;">NGO Admin</div>
                <div style="font-size:12px; opacity:0.9;">System Manager</div>
            </div>
        </div>
    </aside>

    <main class="content">
        {% block content %}{% endblock %}
    </main>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  // Only run summary fetch if element exists
  const elActiveVol = document.getElementById("activeVolunteers");
  if (elActiveVol) loadSummary();

  // If analytics chart canvas exists, load donation trend
  const donationCanvas = document.getElementById("donationTrend");
  if (donationCanvas) loadDonationTrend();
});

function loadSummary() {
  fetch('/api/summary')
    .then(res => res.json())
    .then(data => {
      document.getElementById("activeVolunteers").textContent = data.active_volunteers ?? 0;
      document.getElementById("activeProjects").textContent = data.total_projects ?? 0;
      document.getElementById("totalDonations").textContent = `$${(data.total_donations ?? 0).toFixed(2)}`;
    })
    .catch(err => {
      console.error("Failed to load summary:", err);
    });
}

function loadDonationTrend() {
  fetch('/api/analytics/donations_trend')
    .then(res => res.json())
    .then(rows => {
      // rows: [{month:'2025-06', total: 120.0}, ...]
      const labels = rows.map(r => r.month);
      const data = rows.map(r => r.total);
      renderDonationChart(labels, data);
    })
    .catch(err => console.error("Failed to load donation trend:", err));
}

function renderDonationChart(labels, data) {
  // Chart.js is loaded via CDN in the template
  const ctx = document.getElementById('donationTrend').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Donations',
        data: data,
        fill: false,
        borderWidth: 2,
        tension: 0.3,
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}

// Function to close the stakeholder form modal
function closeForm() {
  document.getElementById('addStakeholderModal').style.display = 'none';
  document.getElementById('stakeholderForm').reset();
}
    </script>
</body>
</html>